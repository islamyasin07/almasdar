<div class="addresses-page">
  <div class="page-header">
    <div>
      <h1 class="page-title">{{ lang.t('accountAddresses.title') }}</h1>
      <p class="page-subtitle">{{ lang.t('accountAddresses.subtitle') }}</p>
    </div>
    <button class="btn-add" (click)="showAddForm()" *ngIf="!showForm">
      <i class="fas fa-plus"></i> {{ lang.t('accountAddresses.addNew') }}
    </button>
  </div>

  <!-- Success/Error Messages -->
  <div class="alert alert-success" *ngIf="message">
    <i class="fas fa-check-circle"></i> {{ message }}
  </div>
  <div class="alert alert-error" *ngIf="error">
    <i class="fas fa-exclamation-circle"></i> {{ error }}
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"><i class="fas fa-spinner fa-spin"></i></div>
    <p>{{ lang.t('accountAddresses.loading') }}</p>
  </div>

  <!-- Address Form -->
  <div *ngIf="showForm" class="address-form-section">
    <div class="form-header">
      <h2>{{ editingAddressId ? lang.t('accountAddresses.editAddress') : lang.t('accountAddresses.addNew') }}</h2>
      <button class="btn-close" (click)="cancelForm()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form [formGroup]="addressForm" (ngSubmit)="saveAddress()">
      <div class="form-grid">
        <div class="form-group full-width">
          <label for="fullName">{{ lang.t('accountAddresses.fullName') }} <span class="required">{{ lang.t('common.required') }}</span></label>
          <input
            id="fullName"
            type="text"
            formControlName="fullName"
            [class.invalid]="isFieldInvalid('fullName')"
            [placeholder]="lang.t('accountAddresses.fullNamePlaceholder')"
          />
          <span class="error-message" *ngIf="isFieldInvalid('fullName')">
            {{ getFieldError('fullName') }}
          </span>
        </div>

        <div class="form-group full-width">
          <label for="phone">{{ lang.t('accountAddresses.phone') }} <span class="required">{{ lang.t('common.required') }}</span></label>
          <input
            id="phone"
            type="tel"
            formControlName="phone"
            [class.invalid]="isFieldInvalid('phone')"
            [placeholder]="lang.t('accountAddresses.phonePlaceholder')"
          />
          <span class="error-message" *ngIf="isFieldInvalid('phone')">
            {{ getFieldError('phone') }}
          </span>
        </div>

        <div class="form-group full-width">
          <label for="street">{{ lang.t('accountAddresses.street') }} <span class="required">{{ lang.t('common.required') }}</span></label>
          <input
            id="street"
            type="text"
            formControlName="street"
            [class.invalid]="isFieldInvalid('street')"
            [placeholder]="lang.t('accountAddresses.streetPlaceholder')"
          />
          <span class="error-message" *ngIf="isFieldInvalid('street')">
            {{ getFieldError('street') }}
          </span>
        </div>

        <div class="form-group full-width">
          <label for="apartment">{{ lang.t('accountAddresses.apartment') }}</label>
          <input
            id="apartment"
            type="text"
            formControlName="apartment"
            [placeholder]="lang.t('accountAddresses.apartmentPlaceholder')"
          />
        </div>

        <div class="form-group">
          <label for="city">{{ lang.t('accountAddresses.city') }} <span class="required">{{ lang.t('common.required') }}</span></label>
          <input
            id="city"
            type="text"
            formControlName="city"
            [class.invalid]="isFieldInvalid('city')"
            [placeholder]="lang.t('accountAddresses.cityPlaceholder')"
          />
          <span class="error-message" *ngIf="isFieldInvalid('city')">
            {{ getFieldError('city') }}
          </span>
        </div>

        <div class="form-group">
          <label for="state">{{ lang.t('accountAddresses.state') }} <span class="required">{{ lang.t('common.required') }}</span></label>
          <input
            id="state"
            type="text"
            formControlName="state"
            [class.invalid]="isFieldInvalid('state')"
            [placeholder]="lang.t('accountAddresses.statePlaceholder')"
          />
          <span class="error-message" *ngIf="isFieldInvalid('state')">
            {{ getFieldError('state') }}
          </span>
        </div>

        <div class="form-group">
          <label for="postalCode">{{ lang.t('accountAddresses.postalCode') }} <span class="required">{{ lang.t('common.required') }}</span></label>
          <input
            id="postalCode"
            type="text"
            formControlName="postalCode"
            [class.invalid]="isFieldInvalid('postalCode')"
            [placeholder]="lang.t('accountAddresses.postalCodePlaceholder')"
          />
          <span class="error-message" *ngIf="isFieldInvalid('postalCode')">
            {{ getFieldError('postalCode') }}
          </span>
        </div>

        <div class="form-group">
          <label for="country">{{ lang.t('accountAddresses.country') }} <span class="required">{{ lang.t('common.required') }}</span></label>
          <input
            id="country"
            type="text"
            formControlName="country"
            [class.invalid]="isFieldInvalid('country')"
            [placeholder]="lang.t('accountAddresses.countryPlaceholder')"
          />
          <span class="error-message" *ngIf="isFieldInvalid('country')">
            {{ getFieldError('country') }}
          </span>
        </div>

        <div class="form-group full-width">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="isDefault" />
            <span>{{ lang.t('accountAddresses.setDefault') }}</span>
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="cancelForm()">
          {{ lang.t('accountAddresses.cancel') }}
        </button>
        <button type="submit" class="btn-primary" [disabled]="isSaving || addressForm.invalid">
          <span *ngIf="!isSaving">
            <i class="fas fa-save"></i> {{ editingAddressId ? lang.t('accountAddresses.updateAddress') : lang.t('accountAddresses.saveAddress') }}
          </span>
          <span *ngIf="isSaving">
            <i class="fas fa-spinner fa-spin"></i> {{ lang.t('accountAddresses.saving') }}
          </span>
        </button>
      </div>
    </form>
  </div>

  <!-- Addresses List -->
  <div *ngIf="!isLoading && !showForm" class="addresses-grid">
    <div *ngIf="addresses.length === 0" class="empty-state">
      <i class="fas fa-map-marker-alt"></i>
      <h3>{{ lang.t('accountAddresses.noAddresses') }}</h3>
      <p>{{ lang.t('accountAddresses.addFirst') }}</p>
      <button class="btn-primary" (click)="showAddForm()">
        <i class="fas fa-plus"></i> {{ lang.t('accountAddresses.addAddress') }}
      </button>
    </div>

    <div *ngFor="let address of addresses" class="address-card">
      <div class="address-header">
        <span class="address-name">{{ address.fullName }}</span>
        <span class="badge-default" *ngIf="address.isDefault">{{ lang.t('accountAddresses.default') }}</span>
      </div>

      <div class="address-content">
        <p><i class="fas fa-map-marker-alt"></i> {{ address.street }}</p>
        <p *ngIf="address.apartment" class="address-apt">{{ address.apartment }}</p>
        <p>{{ address.city }}, {{ address.state }} {{ address.postalCode }}</p>
        <p>{{ address.country }}</p>
        <p class="address-phone"><i class="fas fa-phone"></i> {{ address.phone }}</p>
      </div>

      <div class="address-actions">
        <button class="btn-action btn-edit" (click)="editAddress(address)">
          <i class="fas fa-edit"></i> {{ lang.t('accountAddresses.edit') }}
        </button>
        <button 
          *ngIf="!address.isDefault && address._id" 
          class="btn-action btn-default" 
          (click)="setDefaultAddress(address._id!)"
        >
          <i class="fas fa-star"></i> {{ lang.t('accountAddresses.setDefaultShort') }}
        </button>
        <button class="btn-action btn-delete" *ngIf="address._id" (click)="deleteAddress(address._id!)">
          <i class="fas fa-trash"></i> {{ lang.t('accountAddresses.delete') }}
        </button>
      </div>
    </div>
  </div>
</div>
