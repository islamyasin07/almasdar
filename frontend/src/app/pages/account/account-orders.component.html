<div class="orders-page">
  <div class="page-header">
    <h1 class="page-title">{{ lang.t('accountOrders.title') }}</h1>
    <p class="page-subtitle">{{ lang.t('accountOrders.subtitle') }}</p>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label>{{ lang.t('accountOrders.status') }}</label>
      <select [(ngModel)]="statusFilter" (change)="onStatusFilterChange()" class="filter-select">
        <option value="all">{{ lang.t('accountOrders.allOrders') }}</option>
        <option value="pending">{{ lang.t('accountOrders.pending') }}</option>
        <option value="confirmed">{{ lang.t('accountOrders.confirmed') }}</option>
        <option value="shipped">{{ lang.t('accountOrders.shipped') }}</option>
        <option value="delivered">{{ lang.t('accountOrders.delivered') }}</option>
        <option value="cancelled">{{ lang.t('accountOrders.cancelled') }}</option>
      </select>
    </div>

    <div class="filter-group">
      <label>{{ lang.t('accountOrders.dateRange') }}</label>
      <select [(ngModel)]="dateFilter" (change)="onDateFilterChange()" class="filter-select">
        <option value="all">{{ lang.t('accountOrders.allTime') }}</option>
        <option value="last30days">{{ lang.t('accountOrders.last30Days') }}</option>
        <option value="last90days">{{ lang.t('accountOrders.last90Days') }}</option>
        <option value="thisYear">{{ lang.t('accountOrders.thisYear') }}</option>
      </select>
    </div>

    <div class="filter-group search-group">
      <label>{{ lang.t('accountOrders.search') }}</label>
      <input 
        type="text" 
        [(ngModel)]="searchQuery" 
        (input)="onSearchChange()" 
        [placeholder]="lang.t('accountOrders.searchPlaceholder')" 
        class="search-input"
      />
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"><i class="fas fa-spinner fa-spin"></i></div>
    <p>{{ lang.t('accountOrders.loading') }}</p>
  </div>

  <!-- Orders Table -->
  <div *ngIf="!isLoading && filteredOrders.length > 0" class="orders-table-container">
    <table class="orders-table">
      <thead>
        <tr>
          <th>{{ lang.t('accountOrders.orderId') }}</th>
          <th>{{ lang.t('accountOrders.date') }}</th>
          <th>{{ lang.t('accountOrders.items') }}</th>
          <th>{{ lang.t('accountOrders.total') }}</th>
          <th>{{ lang.t('accountOrders.statusLabel') }}</th>
          <th>{{ lang.t('accountOrders.payment') }}</th>
          <th>{{ lang.t('accountOrders.actions') }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of filteredOrders">
          <td><strong>#{{ order._id.slice(-8) }}</strong></td>
          <td>{{ order.createdAt | date: (lang.isArabic() ? 'd MMM، y' : 'MMM d, y') }}</td>
          <td>{{ getTotalItems(order) }} {{ lang.t('accountOrders.items') }}</td>
          <td>${{ order.total.toFixed(2) }}</td>
          <td>
            <span class="badge" [ngClass]="getStatusClass(order.status)">
              {{ order.status }}
            </span>
          </td>
          <td>
            <span class="badge" [ngClass]="'payment-' + order.paymentStatus">
              {{ order.paymentStatus }}
            </span>
          </td>
          <td>
            <button class="btn-view" (click)="viewOrderDetails(order)">
              <i class="fas fa-eye"></i> {{ lang.t('accountOrders.view') }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button 
        class="page-btn" 
        [disabled]="currentPage === 1" 
        (click)="goToPage(currentPage - 1)"
      >
        <i class="fas fa-chevron-left"></i>
      </button>

      <button 
        *ngFor="let page of paginationPages" 
        class="page-btn" 
        [class.active]="page === currentPage"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>

      <button 
        class="page-btn" 
        [disabled]="currentPage === totalPages" 
        (click)="goToPage(currentPage + 1)"
      >
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredOrders.length === 0" class="empty-state">
    <i class="fas fa-shopping-bag"></i>
    <h3>{{ lang.t('accountOrders.noOrdersFound') }}</h3>
    <p>{{ (searchQuery || statusFilter !== 'all' || dateFilter !== 'all') ? lang.t('accountOrders.tryAdjustFilters') : lang.t('accountOrders.noOrdersYet') }}</p>
    <a *ngIf="!searchQuery && statusFilter === 'all' && dateFilter === 'all'" routerLink="/products" class="btn-primary">
      {{ lang.t('accountOrders.startShopping') }}
    </a>
  </div>
</div>

<!-- Order Details Modal -->
<div class="modal-overlay" *ngIf="selectedOrder" (click)="closeOrderDetails()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ lang.t('accountOrders.details') }}</h2>
      <button class="close-btn" (click)="closeOrderDetails()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <!-- Order Info -->
      <div class="order-info-section">
        <div class="info-row">
          <span class="info-label">{{ lang.t('accountOrders.orderId') }}:</span>
          <span class="info-value">#{{ selectedOrder._id.slice(-8) }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">{{ lang.t('accountOrders.date') }}:</span>
          <span class="info-value">{{ selectedOrder.createdAt | date: (lang.isArabic() ? 'd MMM، y, h:mm a' : 'MMMM d, y, h:mm a') }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">{{ lang.t('accountOrders.statusLabel') }}:</span>
          <span class="badge" [ngClass]="getStatusClass(selectedOrder.status)">
            {{ selectedOrder.status }}
          </span>
        </div>
        <div class="info-row">
          <span class="info-label">{{ lang.t('accountOrders.payment') }}:</span>
          <span class="badge" [ngClass]="'payment-' + selectedOrder.paymentStatus">
            {{ selectedOrder.paymentStatus }}
          </span>
        </div>
        <div class="info-row" *ngIf="selectedOrder.trackingNumber">
          <span class="info-label">{{ lang.t('accountOrders.tracking') }}:</span>
          <span class="info-value">{{ selectedOrder.trackingNumber }}</span>
        </div>
      </div>

      <!-- Items -->
      <div class="order-items-section">
        <h3>{{ lang.t('accountOrders.itemsHeader') }}</h3>
        <div class="order-item" *ngFor="let item of selectedOrder.items">
          <div class="item-info">
            <strong>{{ item.name }}</strong>
            <span class="item-sku">SKU: {{ item.sku }}</span>
          </div>
          <div class="item-quantity">{{ lang.t('accountOrders.qty') }}: {{ item.quantity }}</div>
          <div class="item-price">${{ (item.price * item.quantity).toFixed(2) }}</div>
        </div>
      </div>

      <!-- Shipping Address -->
      <div class="shipping-section">
        <h3>{{ lang.t('accountOrders.shippingAddress') }}</h3>
        <div class="address-card">
          <p><strong>{{ selectedOrder.shippingAddress.fullName }}</strong></p>
          <p>{{ selectedOrder.shippingAddress.street }}</p>
          <p *ngIf="selectedOrder.shippingAddress.apartment">{{ selectedOrder.shippingAddress.apartment }}</p>
          <p>
            {{ selectedOrder.shippingAddress.city }}, 
            {{ selectedOrder.shippingAddress.state }} 
            {{ selectedOrder.shippingAddress.postalCode }}
          </p>
          <p>{{ selectedOrder.shippingAddress.country }}</p>
          <p *ngIf="selectedOrder.shippingAddress.phone">Phone: {{ selectedOrder.shippingAddress.phone }}</p>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="order-summary-section">
        <h3>{{ lang.t('accountOrders.orderSummary') }}</h3>
        <div class="summary-row">
          <span>{{ lang.t('accountOrders.subtotal') }}:</span>
          <span>${{ selectedOrder.subtotal.toFixed(2) }}</span>
        </div>
        <div class="summary-row">
          <span>{{ lang.t('accountOrders.shipping') }}:</span>
          <span>${{ selectedOrder.shippingCost.toFixed(2) }}</span>
        </div>
        <div class="summary-row">
          <span>{{ lang.t('accountOrders.tax') }}:</span>
          <span>${{ selectedOrder.tax.toFixed(2) }}</span>
        </div>
        <div class="summary-row total">
          <span><strong>{{ lang.t('accountOrders.totalLabel') }}:</strong></span>
          <span><strong>${{ selectedOrder.total.toFixed(2) }}</strong></span>
        </div>
      </div>

      <div class="order-notes" *ngIf="selectedOrder.notes">
        <h3>{{ lang.t('accountOrders.notes') }}</h3>
        <p>{{ selectedOrder.notes }}</p>
      </div>
    </div>
  </div>
</div>
