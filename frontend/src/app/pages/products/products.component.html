<div class="products-page">
  <!-- Floating Shapes -->
  <div class="floating-shape">üîí</div>
  <div class="floating-shape">üìπ</div>
  <div class="floating-shape">üõ°Ô∏è</div>

  <!-- Hero Carousel Section -->
  <div class="hero-carousel">
    <div class="carousel-track" [style.transform]="'translateX(-' + (currentSlide * 100) + '%)'">
      <div class="carousel-slide" *ngFor="let slide of featuredSlides; let i = index">
        <div class="slide-image-wrapper">
          <img [src]="slide.image" [alt]="slide.title" class="slide-image">
          <div class="slide-overlay"></div>
        </div>
        <div class="slide-content">
          <h2 class="slide-title">{{ langService.isRTL() ? slide.titleAr : slide.title }}</h2>
          <p class="slide-description">{{ langService.isRTL() ? slide.descriptionAr : slide.description }}</p>
          <button class="slide-cta" (click)="navigateToCategory(slide.category)">
            <span>{{ langService.t('products.explore') }}</span>
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Carousel Controls -->
    <button class="carousel-control prev" (click)="previousSlide()">
      <i class="fas fa-chevron-left"></i>
    </button>
    <button class="carousel-control next" (click)="nextSlide()">
      <i class="fas fa-chevron-right"></i>
    </button>
    
    <!-- Carousel Indicators -->
    <div class="carousel-indicators">
      <button 
        *ngFor="let slide of featuredSlides; let i = index" 
        class="indicator"
        [class.active]="i === currentSlide"
        (click)="goToSlide(i)">
      </button>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">{{ langService.t('products.title') }}</h1>
      <p class="page-subtitle">{{ langService.t('products.subtitle') }}</p>
    </div>

    <!-- Search & Filter Bar -->
    <div class="search-filter-bar">
      <div class="search-section">
        <div class="search-input-wrapper">
          <i class="fas fa-search"></i>
          <input
            type="text"
            [(ngModel)]="searchQuery"
            (keyup.enter)="onSearch()"
            [placeholder]="langService.t('products.searchPlaceholder')"
            class="search-input"
          />
        </div>
        <button (click)="onSearch()" class="search-button">
          <i class="fas fa-search"></i>
          <span>{{ langService.t('common.search') }}</span>
        </button>
      </div>

      <div class="filter-actions">
        <button (click)="toggleFilters()" class="filter-toggle-button">
          <i class="fas fa-filter"></i>
          <span>{{ langService.t('products.filters') }}</span>
        </button>
        
        <select [(ngModel)]="sortBy" (change)="onSortChange()" class="sort-select">
          <option *ngFor="let option of sortOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
    </div>

    <div class="content-wrapper">
      <!-- Sidebar Filters -->
      <aside class="filters-sidebar" [class.show]="showFilters">
        <div class="sidebar-header">
          <h3>{{ langService.t('products.filters') }}</h3>
          <button (click)="clearFilters()" class="clear-button">
            <i class="fas fa-times"></i>
            {{ langService.t('products.clearAll') }}
          </button>
        </div>

        <!-- Category Filter -->
        <div class="filter-group">
          <h4 class="filter-title">{{ langService.t('products.category') }}</h4>
          <div class="filter-options">
            <label *ngFor="let cat of categories" class="filter-option">
              <input
                type="radio"
                name="category"
                [value]="cat.value"
                [(ngModel)]="selectedCategory"
                (change)="onCategoryChange()"
              />
              <span class="radio-custom"></span>
              <span class="option-label">{{ cat.label }}</span>
            </label>
          </div>
        </div>

        <!-- Price Range Filter -->
        <div class="filter-group">
          <h4 class="filter-title">{{ langService.t('products.priceRange') }}</h4>
          <div class="price-inputs">
            <input
              type="number"
              [(ngModel)]="priceRange[0]"
              (change)="onPriceRangeChange()"
              [placeholder]="langService.t('products.min')"
              class="price-input"
            />
            <span class="price-separator">-</span>
            <input
              type="number"
              [(ngModel)]="priceRange[1]"
              (change)="onPriceRangeChange()"
              [placeholder]="langService.t('products.max')"
              class="price-input"
            />
          </div>
          <div class="price-labels">
            <span>${{ priceRange[0] }}</span>
            <span>${{ priceRange[1] }}</span>
          </div>
        </div>

        <!-- Status Filter -->
        <div class="filter-group">
          <h4 class="filter-title">{{ langService.t('products.availability') }}</h4>
          <div class="filter-options">
            <label class="filter-option">
              <input
                type="radio"
                name="status"
                value=""
                [(ngModel)]="selectedStatus"
                (change)="onCategoryChange()"
              />
              <span class="radio-custom"></span>
              <span class="option-label">{{ langService.t('products.allProducts') }}</span>
            </label>
            <label class="filter-option">
              <input
                type="radio"
                name="status"
                value="active"
                [(ngModel)]="selectedStatus"
                (change)="onCategoryChange()"
              />
              <span class="radio-custom"></span>
              <span class="option-label">{{ langService.t('products.inStock') }}</span>
            </label>
            <label class="filter-option">
              <input
                type="radio"
                name="status"
                value="out_of_stock"
                [(ngModel)]="selectedStatus"
                (change)="onCategoryChange()"
              />
              <span class="radio-custom"></span>
              <span class="option-label">{{ langService.t('products.outOfStock') }}</span>
            </label>
          </div>
        </div>
      </aside>

      <!-- Products Grid -->
      <div class="products-section">
        <!-- Results Info -->
        <div class="results-info">
          <span class="results-count">{{ totalProducts }} {{ langService.t('products.productsFound') }}</span>
          <span class="results-page">{{ langService.t('products.page') }} {{ currentPage }} {{ langService.t('products.of') }} {{ totalPages }}</span>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-container">
          <div class="loading-spinner">
            <i class="fas fa-shield-alt fa-spin"></i>
          </div>
          <p>{{ langService.t('common.loading') }}...</p>
        </div>

        <!-- Products Grid -->
        <div *ngIf="!isLoading && products.length > 0" class="products-grid">
          <div *ngFor="let product of products" class="product-card">
            <a [routerLink]="['/products', product._id]" class="product-link">
              <!-- Product Image -->
              <div class="product-image">
                <img
                  [src]="product.images[0] || 'assets/images/placeholder.jpg'"
                  [alt]="product.name"
                  loading="lazy"
                />
                <div class="product-badge" *ngIf="product.stock < 10 && product.status === 'active'">
                  {{ langService.t('products.lowStock') }}
                </div>
                <div class="product-badge out-of-stock" *ngIf="product.status === 'out_of_stock'">
                  {{ langService.t('products.outOfStock') }}
                </div>
                <div class="product-overlay">
                  <button type="button" class="quick-view-button">
                    <i class="fas fa-eye"></i>
                    {{ langService.t('products.quickView') }}
                  </button>
                </div>
              </div>

              <!-- Product Info -->
              <div class="product-info">
                <div class="product-category">{{ product.category }}</div>
                <h3 class="product-name">{{ product.name }}</h3>
                <p class="product-description">{{ product.description | slice:0:80 }}...</p>
                
                <!-- Product Meta -->
                <div class="product-meta">
                  <div class="product-brand" *ngIf="product.brand">
                    <i class="fas fa-tag"></i>
                    {{ product.brand }}
                  </div>
                  <div class="product-stock">
                    <i class="fas fa-box"></i>
                    {{ product.stock }} {{ langService.t('products.inStockLabel') }}
                  </div>
                </div>

                <!-- Product Footer -->
                <div class="product-footer">
                  <div class="product-price">${{ product.price.toFixed(2) }}</div>
                  <button type="button" class="add-to-cart-button" (click)="$event.preventDefault(); $event.stopPropagation(); addToCart(product)" [disabled]="product.status === 'out_of_stock' || product.stock <= 0">
                    <i class="fas fa-shopping-cart"></i>
                    {{ langService.t('products.addToCart') }}
                  </button>
                </div>
              </div>
            </a>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && products.length === 0" class="empty-state">
          <i class="fas fa-box-open"></i>
          <h3>{{ langService.t('products.noProductsFound') }}</h3>
          <p>{{ langService.t('products.tryAdjusting') }}</p>
          <button (click)="clearFilters()" class="btn-primary">
            {{ langService.t('products.clearFilters') }}
          </button>
        </div>

        <!-- Pagination -->
        <div *ngIf="!isLoading && products.length > 0 && totalPages > 1" class="pagination">
          <button
            (click)="goToPage(currentPage - 1)"
            [disabled]="currentPage === 1"
            class="pagination-button"
          >
            <i [class]="langService.isRTL() ? 'fas fa-chevron-right' : 'fas fa-chevron-left'"></i>
            {{ langService.t('common.previous') }}
          </button>

          <div class="pagination-pages">
            <button
              *ngFor="let page of pages"
              (click)="goToPage(page)"
              [class.active]="page === currentPage"
              class="pagination-page"
            >
              {{ page }}
            </button>
          </div>

          <button
            (click)="goToPage(currentPage + 1)"
            [disabled]="currentPage === totalPages"
            class="pagination-button"
          >
            {{ langService.t('common.next') }}
            <i [class]="langService.isRTL() ? 'fas fa-chevron-left' : 'fas fa-chevron-right'"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
