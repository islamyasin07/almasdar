<nav class="sticky top-0 z-50 bg-slate-custom-900 dark:bg-slate-custom-950 border-b border-slate-custom-700 dark:border-slate-custom-800 shadow-lg transition-colors backdrop-blur-sm bg-opacity-95">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a routerLink="/" class="flex items-center space-x-3 hover-scale">
        <img 
          src="/assets/images/hikvision-logo.svg" 
          alt="Hikvision" 
          class="h-10 w-auto dark:brightness-110"
        />
        <span class="text-xl font-bold text-white hidden md:block">
          Almasdar Security
        </span>
      </a>

      <!-- Search Bar (Desktop) -->
      <div class="hidden lg:flex flex-1 max-w-2xl mx-8">
        <div class="relative w-full">
          <input
            type="text"
            [(ngModel)]="searchQuery"
            [placeholder]="langService.t('nav.searchPlaceholder')"
            class="w-full px-6 py-3 rounded-full bg-slate-custom-800 dark:bg-slate-custom-900 border border-slate-custom-700 text-white placeholder-gray-400 focus:outline-none focus:border-hik-red focus:ring-2 focus:ring-hik-red/20 transition-all"
            (keyup.enter)="onSearch()"
          />
          <button (click)="onSearch()" [class]="langService.isRTL() ? 'absolute left-3 top-1/2 -translate-y-1/2 text-hik-red hover:text-hik-red-dark transition-colors' : 'absolute right-3 top-1/2 -translate-y-1/2 text-hik-red hover:text-hik-red-dark transition-colors'">
            <i class="fas fa-search text-xl"></i>
          </button>
        </div>
      </div>

      <!-- Desktop Menu -->
      <div class="hidden lg:flex items-center" [ngClass]="langService.isRTL() ? 'space-x-reverse space-x-6' : 'space-x-6'">
        <a routerLink="/products" routerLinkActive="text-hik-red" class="nav-link">
          <i class="fas fa-boxes" [ngClass]="langService.isRTL() ? 'ml-2' : 'mr-2'"></i>{{ langService.t('nav.products') }}
        </a>
        <a routerLink="/categories" routerLinkActive="text-hik-red" class="nav-link">
          <i class="fas fa-th-large" [ngClass]="langService.isRTL() ? 'ml-2' : 'mr-2'"></i>{{ langService.t('nav.categories') }}
        </a>
        <a *ngIf="authService.isStaff" routerLink="/admin" routerLinkActive="text-hik-red" class="nav-link">
          <i class="fas fa-tools" [ngClass]="langService.isRTL() ? 'ml-2' : 'mr-2'"></i>{{ langService.t('nav.admin') }}
        </a>
        <a *ngIf="authService.isAuthenticated && !authService.isStaff" routerLink="/account" routerLinkActive="text-hik-red" class="nav-link">
          <i class="fas fa-user" [ngClass]="langService.isRTL() ? 'ml-2' : 'mr-2'"></i>{{ langService.t('nav.account') }}
        </a>
        
        <!-- Language Toggle -->
        <button 
          (click)="toggleLanguage()" 
          class="nav-icon p-2 rounded-lg hover:bg-slate-custom-800 dark:hover:bg-slate-custom-900 transition-colors flex items-center gap-2"
          [title]="langService.isArabic() ? 'Switch to English' : 'التبديل إلى العربية'"
        >
          <span class="text-sm font-semibold text-gray-300">{{ langService.isArabic() ? 'EN' : 'عربي' }}</span>
          <i class="fas fa-language text-xl text-gray-300"></i>
        </button>
        
        <!-- Dark Mode Toggle -->
        <button 
          (click)="toggleTheme()" 
          class="nav-icon p-2 rounded-lg hover:bg-slate-custom-800 dark:hover:bg-slate-custom-900 transition-colors"
          [title]="langService.isArabic() ? 'تبديل الوضع الداكن' : 'Toggle deeper dark mode'"
        >
          <i *ngIf="!themeService.isDark()" class="fas fa-adjust text-xl text-gray-300"></i>
          <i *ngIf="themeService.isDark()" class="fas fa-moon text-xl text-blue-400"></i>
        </button>
        
        <!-- Wishlist -->
        <a *ngIf="authService.isAuthenticated" routerLink="/wishlist" class="nav-icon relative">
          <i class="fas fa-heart text-2xl"></i>
          <span *ngIf="wishlistCount > 0" class="absolute -top-2 -right-2 bg-hik-red text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
            {{ wishlistCount }}
          </span>
        </a>

        <!-- Cart -->
        <a href="#" (click)="$event.preventDefault(); openCart();" class="nav-icon relative">
          <i class="fas fa-shopping-cart text-2xl"></i>
          <span *ngIf="cartItemCount > 0" class="absolute -top-2 -right-2 bg-hik-red text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">
            {{ cartItemCount }}
          </span>
        </a>

        <!-- User Menu -->
        <div *ngIf="authService.isAuthenticated; else loginBtn" class="relative">
          <button 
            (click)="toggleProfileDropdown()" 
            class="flex items-center space-x-2 nav-link focus:outline-none"
          >
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-hik-red to-hik-red-dark flex items-center justify-center shadow-lg">
              <span class="text-white font-bold text-sm">{{ userInitials }}</span>
            </div>
            <span class="hidden xl:block">{{ userName }}</span>
            <i class="fas fa-chevron-down text-sm transition-transform" [class.rotate-180]="isProfileDropdownOpen"></i>
          </button>

          <!-- Dropdown Menu -->
          <div 
            *ngIf="isProfileDropdownOpen"
            class="absolute right-0 mt-2 w-64 rounded-lg shadow-xl bg-slate-custom-800 dark:bg-slate-custom-900 border border-slate-custom-700 overflow-hidden z-50 animate-fade-in"
          >
            <!-- User Info Header -->
            <div class="px-4 py-3 bg-gradient-to-br from-hik-red/10 to-hik-red-dark/10 border-b border-slate-custom-700">
              <p class="text-white font-semibold">{{ userName }}</p>
              <p class="text-gray-400 text-sm">{{ authService.currentUserValue?.email }}</p>
              <span class="inline-block mt-2 px-2 py-1 bg-hik-red/10 text-hik-red text-xs rounded-full border border-hik-red/30">
                {{ authService.currentUserValue?.role }}
              </span>
            </div>

            <!-- Menu Items -->
            <div class="py-2">
              <a 
                *ngIf="!authService.isStaff"
                routerLink="/account" 
                (click)="closeProfileDropdown()" 
                class="dropdown-item"
              >
                <i class="fas fa-tachometer-alt text-hik-red" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.dashboard') }}
              </a>
              <a 
                *ngIf="!authService.isStaff"
                routerLink="/account/orders" 
                (click)="closeProfileDropdown()" 
                class="dropdown-item"
              >
                <i class="fas fa-box text-hik-red" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.myOrders') }}
              </a>
              <a 
                *ngIf="!authService.isStaff"
                routerLink="/account/profile" 
                (click)="closeProfileDropdown()" 
                class="dropdown-item"
              >
                <i class="fas fa-user-edit text-hik-red" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.profile') }}
              </a>
              <a 
                *ngIf="!authService.isStaff"
                routerLink="/account/addresses" 
                (click)="closeProfileDropdown()" 
                class="dropdown-item"
              >
                <i class="fas fa-map-marker-alt text-hik-red" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.addresses') }}
              </a>
              <a 
                *ngIf="authService.isStaff" 
                routerLink="/admin" 
                (click)="closeProfileDropdown()" 
                class="dropdown-item text-hik-red"
              >
                <i class="fas fa-crown" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.adminPanel') }}
              </a>
              <hr class="my-2 border-gray-700">
              <button 
                (click)="logout()" 
                class="dropdown-item text-red-400 hover:bg-red-900/20 w-full text-left"
              >
                <i class="fas fa-sign-out-alt" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.logout') }}
              </button>
            </div>
          </div>
        </div>

        <ng-template #loginBtn>
          <a routerLink="/login" class="btn-gradient px-6 py-2 rounded-full font-semibold">
            <i class="fas fa-sign-in-alt" [ngClass]="langService.isRTL() ? 'ml-2' : 'mr-2'"></i>{{ langService.t('nav.login') }}
          </a>
        </ng-template>
      </div>

      <!-- Mobile Menu Button -->
      <button (click)="toggleMenu()" class="lg:hidden text-gray-300 text-2xl hover:text-hik-red transition-colors">
        <i class="fas" [class.fa-bars]="!isMenuOpen" [class.fa-times]="isMenuOpen"></i>
      </button>
    </div>

    <!-- Mobile Search -->
    <div class="lg:hidden pb-4">
      <div class="relative">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          [placeholder]="langService.t('nav.searchPlaceholder')"
          class="w-full px-4 py-2 rounded-full bg-slate-custom-800 dark:bg-slate-custom-900 border border-slate-custom-700 text-white placeholder-gray-400 focus:outline-none focus:border-hik-red focus:ring-2 focus:ring-hik-red/20"
          (keyup.enter)="onSearch()"
        />
        <button (click)="onSearch()" [class]="langService.isRTL() ? 'absolute left-3 top-1/2 -translate-y-1/2 text-hik-red' : 'absolute right-3 top-1/2 -translate-y-1/2 text-hik-red'">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div 
    class="lg:hidden overflow-hidden transition-all duration-300 ease-in-out border-t border-slate-custom-700"
    [class.max-h-0]="!isMenuOpen"
    [class.max-h-screen]="isMenuOpen"
  >
    <div class="container mx-auto px-4 py-4 space-y-3">
      <a routerLink="/products" (click)="toggleMenu()" class="mobile-menu-item">
        <i class="fas fa-boxes" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.products') }}
      </a>
      <a routerLink="/categories" (click)="toggleMenu()" class="mobile-menu-item">
        <i class="fas fa-th-large" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.categories') }}
      </a>
      
      <!-- Language Toggle (Mobile) -->
      <button (click)="toggleLanguage()" class="mobile-menu-item w-full text-left">
        <i class="fas fa-language text-hik-red" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>
        <span *ngIf="langService.isArabic()">English</span>
        <span *ngIf="!langService.isArabic()">العربية</span>
      </button>
      
      <!-- Dark Mode Toggle (Mobile) -->
      <button (click)="toggleTheme()" class="mobile-menu-item w-full text-left">
        <i *ngIf="!themeService.isDark()" class="fas fa-moon" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>
        <i *ngIf="themeService.isDark()" class="fas fa-sun text-yellow-500" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>
        <span *ngIf="!themeService.isDark()">Dark Mode</span>
        <span *ngIf="themeService.isDark()">Light Mode</span>
      </button>
      
      <div *ngIf="authService.isAuthenticated" class="pt-2 border-t border-slate-custom-700 space-y-3">
        <a routerLink="/wishlist" (click)="toggleMenu()" class="mobile-menu-item">
          <i class="fas fa-heart" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.wishlist') }}
          <span *ngIf="wishlistCount > 0" [ngClass]="langService.isRTL() ? 'mr-auto' : 'ml-auto'" class="bg-hik-red text-white px-2 py-1 rounded-full text-xs">
            {{ wishlistCount }}
          </span>
        </a>
        <a href="#" (click)="$event.preventDefault(); openCart(); toggleMenu();" class="mobile-menu-item">
          <i class="fas fa-shopping-cart" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.cart') }}
          <span *ngIf="cartItemCount > 0" [ngClass]="langService.isRTL() ? 'mr-auto' : 'ml-auto'" class="bg-hik-red text-white px-2 py-1 rounded-full text-xs">
            {{ cartItemCount }}
          </span>
        </a>
        <a routerLink="/account" (click)="toggleMenu()" class="mobile-menu-item">
          <i class="fas fa-tachometer-alt" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.dashboard') }}
        </a>
        <a routerLink="/account/orders" (click)="toggleMenu()" class="mobile-menu-item">
          <i class="fas fa-box" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.myOrders') }}
        </a>
        <a routerLink="/account/profile" (click)="toggleMenu()" class="mobile-menu-item">
          <i class="fas fa-user-cog" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.profile') }}
        </a>
        <a *ngIf="authService.isStaff" routerLink="/admin" (click)="toggleMenu()" class="mobile-menu-item text-hik-red font-semibold">
          <i class="fas fa-crown" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.adminPanel') }}
        </a>
        <button (click)="logout()" class="mobile-menu-item text-red-600 dark:text-red-400 w-full text-left">
          <i class="fas fa-sign-out-alt" [ngClass]="langService.isRTL() ? 'ml-3' : 'mr-3'"></i>{{ langService.t('nav.logout') }}
        </button>
      </div>

      <div *ngIf="!authService.isAuthenticated" class="pt-2 border-t border-slate-custom-700">
        <a routerLink="/login" (click)="toggleMenu()" class="btn-gradient block text-center px-6 py-3 rounded-full font-semibold">
          <i class="fas fa-sign-in-alt" [ngClass]="langService.isRTL() ? 'ml-2' : 'mr-2'"></i>{{ langService.t('nav.login') }}
        </a>
      </div>
    </div>
  </div>
</nav>
