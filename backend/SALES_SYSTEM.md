# ğŸ“Š Ù†Ø¸Ø§Ù… Ø¯ÙØªØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª - Sales Ledger System

Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø²Ø¨Ø§Ø¦Ù† Ù…Ø¹ ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ©ØŒ Ø§Ù„Ø¯ÙØ¹Ø§ØªØŒ ÙˆØ§Ù„Ø¥Ø±Ø¬Ø§Ø¹Ø§Øª.

## âœ¨ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
- âœ… ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ ÙƒØ§Ù…Ù„Ø©
- âœ… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ (Serial Number)
- âœ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù„ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹
- âœ… Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠ
- âœ… Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø±ÙØ¹ ØµÙˆØ± Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

### ğŸ’° Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª
- âœ… Ø¯ÙØ¹Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© (ØªÙ‚Ø³ÙŠØ·)
- âœ… Ø·Ø±Ù‚ Ø¯ÙØ¹ Ù…ØªÙ†ÙˆØ¹Ø©: Ù†Ù‚Ø¯Ø§Ù‹ØŒ Ø¨Ø·Ø§Ù‚Ø©ØŒ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ
- âœ… ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠ
- âœ… Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¨ÙŠØ¹: Ù…Ø¹Ù„Ù‚ØŒ Ø¬Ø²Ø¦ÙŠØŒ Ù…Ø¯ÙÙˆØ¹ ÙƒØ§Ù…Ù„Ø§Ù‹

### ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
- âœ… Ø¥Ù†Ø´Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø²Ø¨ÙˆÙ† Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯
- âœ… Ø¨Ø­Ø« Ø°ÙƒÙŠ Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
- âœ… ØªØªØ¨Ø¹ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ø¥Ù†ÙØ§Ù‚
- âœ… Ø³Ø¬Ù„ ÙƒØ§Ù…Ù„ Ù„ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡

### ğŸ”„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹Ø§Øª
- âœ… Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø­Ø¯Ø¯Ø©
- âœ… ØªØ³Ø¬ÙŠÙ„ Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ ÙˆØªØ§Ø±ÙŠØ®Ù‡
- âœ… ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙŠØ¹

### ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
- âœ… Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØªØ±Ø©
- âœ… Ø£ÙØ¶Ù„ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
- âœ… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…
- âœ… ØªØ­Ù„ÙŠÙ„ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹

## ğŸ—„ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### Schema: Customer (Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†)
```typescript
{
  name: string,           // Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† (Ù…Ø·Ù„ÙˆØ¨)
  phone?: string,         // Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ù…ÙÙ‡Ø±Ø³)
  email?: string,         // Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ Ù…ÙÙ‡Ø±Ø³)
  address?: string,       // Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
  notes?: string,         // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  totalPurchases: number, // Ø¹Ø¯Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡
  totalSpent: number,     // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ù†ÙØ§Ù‚
  createdAt: Date,
  updatedAt: Date
}
```

**Indexes:**
- `name` (index)
- `phone` (sparse index)
- `email` (sparse index)
- Text index: `name`, `phone`, `email`
- `totalSpent` (desc)
- `totalPurchases` (desc)
- `createdAt` (desc)

### Schema: Sale (Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª)
```typescript
{
  customerId: ObjectId,      // Ù…Ø±Ø¬Ø¹ Ù„Ù„Ø²Ø¨ÙˆÙ† (Ù…Ø·Ù„ÙˆØ¨ØŒ Ù…ÙÙ‡Ø±Ø³)
  customerName: string,      // Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† (Ù…Ø·Ù„ÙˆØ¨ØŒ Ù…ÙÙ‡Ø±Ø³)
  items: [                   // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    {
      productId?: ObjectId,
      serialNumber: string,  // Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ (Ù…Ø·Ù„ÙˆØ¨ØŒ Ù…ÙÙ‡Ø±Ø³)
      productName: string,
      quantity: number,
      price: number,
      images?: string[],
      isReturned?: boolean,
      returnDate?: Date,
      returnReason?: string
    }
  ],
  totalAmount: number,       // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
  paidAmount: number,        // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ (Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
  remainingAmount: number,   // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
  payments: [                // Ø§Ù„Ø¯ÙØ¹Ø§Øª
    {
      amount: number,
      date: Date,
      method: string,        // cash, card, bank
      notes?: string
    }
  ],
  status: string,            // pending, paid, partial, returned (Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
  notes?: string,
  createdBy: ObjectId,       // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ù†Ø´Ø¦
  saleDate: Date,            // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨ÙŠØ¹ (Ù…ÙÙ‡Ø±Ø³)
  createdAt: Date,
  updatedAt: Date
}
```

**Indexes:**
- `customerId` (index)
- `customerName` (index + text index)
- `items.serialNumber` (index)
- `status` (index)
- `saleDate` (desc)
- `createdBy` (index)
- `createdAt` (desc)
- `totalAmount` (desc)
- `remainingAmount` (desc)
- Compound: `customerId + saleDate`
- Compound: `status + saleDate`
- Compound: `createdBy + saleDate`

### Schema: Product (ØªØ­Ø¯ÙŠØ«)
```typescript
{
  // ... Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ...
  serialNumber?: string,  // Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ ÙØ±ÙŠØ¯ØŒ Ù…ÙÙ‡Ø±Ø³)
  // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ ...
}
```

**Indexes Ø§Ù„Ù…Ø¶Ø§ÙØ©:**
- `serialNumber` (unique sparse index)
- Text index: includes `serialNumber`

## ğŸ›£ï¸ API Endpoints

### Customers API
```
POST   /api/customers/search-or-create  - Ø¨Ø­Ø« Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø¨ÙˆÙ†
GET    /api/customers                   - Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†
GET    /api/customers/:id               - ØªÙØ§ØµÙŠÙ„ Ø²Ø¨ÙˆÙ†
PUT    /api/customers/:id               - ØªØ­Ø¯ÙŠØ« Ø²Ø¨ÙˆÙ†
DELETE /api/customers/:id               - Ø­Ø°Ù Ø²Ø¨ÙˆÙ†
```

### Sales API
```
POST   /api/sales                       - Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹
GET    /api/sales                       - Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
GET    /api/sales/:id                   - ØªÙØ§ØµÙŠÙ„ Ø¨ÙŠØ¹
PUT    /api/sales/:id                   - ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ¹
DELETE /api/sales/:id                   - Ø­Ø°Ù Ø¨ÙŠØ¹
POST   /api/sales/:id/payment           - Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø©
POST   /api/sales/return-item           - Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ù†ØªØ¬
GET    /api/sales/search-product        - Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ
```

### Database API
```
GET    /api/database/health             - Ø­Ø§Ù„Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù€ indexes
GET    /api/database/sales-stats        - Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
```

## ğŸ¨ Frontend Components

### AdminSalesComponent
ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©:
- Ø¨Ø­Ø« ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø²Ø¨ÙˆÙ†
- Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ
- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª
- Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
- Glass/Glow effects

**Route:** `/admin/sales/new`

### AdminSalesHistoryComponent
ØµÙØ­Ø© Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:
- ÙƒØ±ÙˆØª ØªÙ„Ø®ÙŠØµÙŠØ©
- ÙÙ„Ø§ØªØ± Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
- Ø¨Ø­Ø« Ù…ØªÙ‚Ø¯Ù…
- Modal Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¹
- Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø§Øª
- Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ù†ØªØ¬Ø§Øª

**Route:** `/admin/sales`

## ğŸ” Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª

Ø¬Ù…ÙŠØ¹ endpoints ØªØªØ·Ù„Ø¨:
- Authentication (JWT Token)
- Authorization: `admin` Ø£Ùˆ `staff`

## ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±

### Database Health
```typescript
GET /api/database/health

Response:
{
  collections: {
    customers: { count: number },
    sales: { count: number },
    products: { count: number }
  },
  indexes: {
    customer: { count: number, indexes: string[] },
    product: { count: number, indexes: string[] },
    sale: { count: number, indexes: string[] }
  },
  indexesValid: boolean
}
```

### Sales Statistics
```typescript
GET /api/database/sales-stats?period=30d

Response:
{
  period: '7d' | '30d' | '90d' | '1y',
  startDate: Date,
  endDate: Date,
  summary: {
    totalSales: number,
    totalPaid: number,
    totalRemaining: number,
    salesCount: number,
    avgSaleAmount: number,
    maxSaleAmount: number,
    minSaleAmount: number
  },
  statusBreakdown: {
    paid: { count: number, totalAmount: number },
    partial: { count: number, totalAmount: number },
    pending: { count: number, totalAmount: number }
  },
  topCustomers: Array<{
    customerName: string,
    totalSpent: number,
    purchaseCount: number
  }>,
  salesByDay: Array<{
    date: string,
    totalAmount: number,
    salesCount: number
  }>
}
```

## ğŸš€ Ø§Ù„ØªØ´ØºÙŠÙ„

### Backend
```bash
cd backend
npm install
npm run dev
```

### Frontend
```bash
cd frontend
npm install
npm start
```

## âœ… Validation & Testing

### Check Database Health
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:5000/api/database/health
```

### Check Sales Statistics
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/database/sales-stats?period=30d"
```

## ğŸ“ Notes

1. **Indexes:** ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ indexes ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
2. **Status Calculation:** Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙŠØ¹ (status) ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ `pre-save` hook
3. **Customer Stats:** Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²Ø¨ÙˆÙ† (totalPurchases, totalSpent) ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ø¹Ù†Ø¯ ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹
4. **Serial Numbers:** Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© ÙØ±ÙŠØ¯Ø© Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª

## ğŸŒ Ø§Ù„ØªØ±Ø¬Ù…Ø©

Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„:
- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
- Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±

## ğŸ¨ Ø§Ù„ØªØµÙ…ÙŠÙ…

- Dark theme with red accents (#dc2626)
- Glass morphism effects
- Smooth animations
- Responsive design
- RTL support for Arabic

---

Made with â¤ï¸ for Al-Masdar Security
